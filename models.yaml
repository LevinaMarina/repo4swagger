components:
  schemas:

    EventsCallReqBodyAll:
      type: object
      properties:
        vpbx_api_key:
          type: string
          example: "1234567890qwerty"
          description: "Уникальный код вашей ВАТС. Это обязательный элемент запроса, по которогому ВАТС определяет внешнюю систему, от корой отправлен запрос"
        sign:
          type: string
          example: "1234567890qwerty"
          description: "sign рассчитывается по формуле"
        json:
          $ref: "#/components/schemas/EventsCallReqBody"

    EventsCallReqBody:
      type: object
      properties:
        entry_id:
          type: string
          example: "1MN0Q1MDOQ="
          description: "Внутренний идентификатор группы вызовов. Идентификатор назначается при поступлении вызова в ВАТС и не изменяется. Все последующие вызовы (переадресация, перевод средствами ВАТС), генерируемые в процессе обработки вызова, будут иметь одинаковое значения поля. Не имеет отношения к CALL-ID из SIP протокола. Строка не более 128 байт. Уникальность идентификатора гарантируется ВАТС на протяжении всего периода оказания услуг по данному API. Внутренний формат идентификатора не должен как-либо использоваться внешней системой. Реализация ВАТС может изменять принцип генерации идентификатора, не нарушая при этом соглашение об уникальности"
        call_id:
          type: string
          example: "MIxEyNTzTo6NDxkzNMMOzNQ="
          description: "Внутренний идентификатор вызова (плеча вызова), строка не более 128 байт. Не имеет отношения к CALL-ID из SIP протокола. Уникальность идентификатора вызова гарантируется ВАТС на протяжении всего периода оказания услуг по данному API. Внутренний формат идентификатора не должен как-либо использоваться внешней системой. Реализация ВАТС может изменять принцип генерации идентификатора вызова, не нарушая при этом соглашение об уникальности"
        timestamp:
          type: string
          format: date-time
          example: "1558422128"
          description: Время события UTC+3
        seq:
          type: string
          example: 1
          description: "Счетчик последовательности уведомлений по вызову. Получение события о состоянии вызова внешней системой может происходить в последовательности, отличной от той, в которой они происходили в ВАТС (подробнее о счетчике). Это связанно с тем, что уведомления могут отправляться параллельно, без ожидания ответа на каждый запрос. При обработке событий их необходимо упорядочивать, либо просто игнорировать новое событие с меньшим значением seq."
        call_state:
          type: string
          example: "Disconnected"
          description: "Текущее состояние вызова"
        location:
          type: string
          example: ivr
          description: "Текущее расположение вызова. Где ivr - голосовое меню,  queue - очередь дозвона на группу, abonent - сотрудник ВАТС"
          enum:
            - ivr
            - queue
            - abonent
        from:
          $ref: '#/components/schemas/EventsCallReqBodyFrom'
        to:
          $ref: '#/components/schemas/EventsCallReqBodyTo'
        dct:
          $ref: '#/components/schemas/EventsCallReqBodyDct'  
        disconnect_reason:
          type: string
          example: "1131"
          description: "Причина завершения вызова (см. ниже). Опциональный параметр. Передается в состоянии вызова Disconnected"
        transfer:
          $ref: '#/components/schemas/EventsCallReqBodyTransfer'
        sip_call_id:
          type: string
          example: "7"
          description: "Идентификатор входящего  звонка по SIP, сформированный внешней системой (Клиентом)"
        command_id:
          type: string
          example: "7"
          description: "Идентификатор команды внешней системы, в результате которой появился вызов (строка не более 128 байт). Опциональный параметр. Уникальность строки для внешней системы гарантируется внешней системой"
        task_id:
          type: string
          example: "7"
          description: "Опционально, идентификатор задачи исходящего обзвона, в результате которой появился вызов. Передается в случае, если звонок инициирован или ObDial, или CallbackWidget, или MissGroupСallCallback. В остальных случаях отсутствует"
        callback_initiator:
          type: string
          example: "7"
          description: "Опционально, инициатор обратного звонка, в результате которого появился вызов (строка не более 128 байт). Передается, если звонок - callback. При обычном звонке отсутствует."
    EventsCallReqBodyFrom:
      type: object
      description: "Данные, относящиеся к вызывающему абоненту"
      properties:
        extension:
          type: string
          example: "7"
          description: "Идентификатор сотрудника ВАТС для вызывающего абонента. Опциональный параметр. Не передается в случае, если ВАТС не удалось идентифицировать вызывающего абонента как сотрудника ВАТС"
        number:
          type: string
          example: "79001234567"
          description: "Номер вызывающего абонента (строка), в случае, если ВАТС удалось определить номер. Опциональный параметр"
        taken_from_call_id:
          type: string
          example: "oMNTMyzTzNTo6NxNkDIxOxM3EMNTj"
          description: "Идентификатор вызова, в котором участвовал вызывающий абонент, до того, как был переведен в текущий вызов. Опциональный параметр"
        was_transferred:
          type: boolean
          example: false
          description: "true - признак того, что данный абонент переведен на другого абонента 'командой перевод'. Доступен с версии api v.2. По умолчанию false. Возможен только в состоянии Disconnected. Если признак в секции from, то данный вызов покинул вызываемый абонент. Если признак в секции to, то данный вызов покинул вызывающий абонент"
        hold_initiator:
          type: boolean
          example: true
          description: "true признак того, что данный абонент поставил вызов (противоположного участника) на удержание. Доступен с версии api v.2. По умолчанию false. Возможен только в состоянии OnHold"
    EventsCallReqBodyTo:
        type: object
        properties:
          extension:
            type: string
            example: "29"
            description: "идентификатор сотрудника ВАТС для вызываемого абонента. Опциональный параметр. Не передается, если ВАТС не удалось идентифицировать вызываемого абонента как сотрудника ВАТС, у сотрудника ВАТС нет идентификатора (внутреннего номера), вызов еще не был распределен на сотрудника"
          number:
            type: string
            example: "sip:user00000@tech.mangosip.ru"
            description: "номер вызываемого абонента (строка)"
          line_number:
            type: string
            example: "sip:line00000@tech.mangosip.ru"
            description: "входящая линия ВАТС, на которую поступил вызов. Опциональный параметр"
          acd_group:
            type: string
            example: "303"
            description: "идентификатор группы операторов ВАТС (внутренний номер группы). Опциональный параметр. Передается в случае маршрутизации вызова через группу сотрудников ВАТС. Если группе не присвоен короткий номер, передается пустое значение"
          was_transferred:
            type: boolean
            example: true
            description: true признак того, что данный абонент переведен на другого абонента 'командой перевод'. Доступен с версии api v.2. По умолчанию false. Возможен только в состоянии "Disconnected". Если признак в секции from, то данный вызов покинул вызываемый абонент. Если признак в секции to, то данный вызов покинул вызывающий абонент
          hold_initiator:
            type: boolean
            example: true
            description: true признак того, что данный абонент поставил вызов (противоположного участника) на удержание. Доступен с версии api v.2. По умолчанию false. Возможен только в состоянии OnHold
    EventsCallReqBodyDct:
        type: object
        properties:
          number:
            type: string
            example: "7"
            description: тип данных строковый, номер коллтрекинга (динамический или статический). Опциональный параметр
          type:
            type: integer
            description: тип данных числовой. Обязательный параметр. Где, 0 - не относится к коллтрекингу, 1 - динамический номер, 2 - статический номер
            example: 1
            enum:
              - 0
              - 1
              - 2
    EventsCallReqBodyTransfer:
        type: object
        properties:
          consultative:
            type: string
            example: "7"
            description: вызывающий абонент из taken_from_call_id выполняет консультативный перевод
          blind:
            type: string
            example: "7"
            description: вызывающий абонент был переведен из taken_from_call_id другим участником вызова taken_from_call_id, который покинул разговор
          return_blind:
            type: string
            example: "7"
            description: возврат слепого перевода. При неответе адресата перевода (консультанта), клиент (переводимый абонент) перезванивает исходному оператору (инициатору перевода). При слепом переводе из консультативного вызова (консультант ответил и оператор положил трубку), новый вызов не создается, а будет второе "Connected" событие с подменой звонящего абонента. При этом тип перевода меняется с consultative на blind
    EventsSmsBody:
      type: object
      properties:
        command_id:
          type: string
          example: "1sjdhjh1231"
          description: Идентификатор команды внешней системы, в результате которой появился вызов (строка не более 128 байт). Уникальность строки для внешней системы гарантируется внешней системой
        timestamp:
          type: string
          format: date-time
          example: "1399906980"
          description: время события UTC+3
        reason:
          type: string
          example: "1000"
          description: результат отправки SMS (см. "Список кодов результатов", коды 43хх)
    CommandsCallback:
      type: object
      properties:
        command_id:
          type: string
          example: "cbk1"
          description: "Идентификатор команды внешней системы, в результате которой появился вызов (строка не более 128 байт). Уникальность строки для внешней системы гарантируется внешней системой"
        from:
          $ref: '#/components/schemas/CommandsCallbackFrom'  
        to_number:
          type: string
          example: "cbk1"
          description: "Номер вызываемого абонента (строка не более 128 байт). Может быть идентификатором сотрудника ВАТС, внутренним номером группы операторов ВАТС или любым другим номером. К номеру будут применены правила преобразования номеров ВАТС"
        line_number:
          type: string
          example: "cbk24455"
          description: "Линия, которая была использована для размещения вызова. Поле опциональное, если заполнено - ВАТС будет использовать указанную в этом параметре линию. Разрешается использовать только линии продукта, за счет которого будет происходить вызов. На данный момент поддерживаются следующие типы линий - SIP UAC, номера 7-800, DID номера манго. Важно! Чтобы вызов прошел через sip-линию, Вам  нужно указать имя  этой линии (а не SIP URI) в параметре line_number. Имя sip-линии задается в Личном кабинете MANGO OFFICE."
        sip_headers:
          $ref: '#/components/schemas/CommandsCallback_sip_headers'
    CommandsCallback_sip_headers:
      type: object
      description: "Опциональное поле, которое содержит список заголовков сип, которые могут быть переданы внешней системой в ВАТС"
      properties:
        Call-Info/answer-after:
          type: string
          example: "cbk1"
          description: "Опциональное, строка не более 64 байт"
    CommandsCallbackFrom:
      type: object
      properties:  
        extension:
          type: string
          example: "7"
          description: Идентификатор сотрудника ВАТС для вызывающего абонента. Опциональный параметр. Не передается в случае, если ВАТС не удалось идентифицировать вызывающего абонента как сотрудника ВАТС
        number:
          type: string
          example: "79001234567"
          description: Номер вызывающего абонента (строка), в случае, если ВАТС удалось определить номер. Опциональный параметр      
    CommandsCallbackResponses:
      type: object
      properties:
        command_id:
          type: string
          example: "cbk1"
          description: "Идентификатор команды внешней системы, в результате которой появился вызов (строка не более 128 байт). Уникальность строки для внешней системы гарантируется внешней системой"
        from:
          $ref: '#/components/schemas/CommandsCallbackFrom'  
        to_number:
          type: string
          example: "cbk1"
          description: "номер вызываемого абонента (строка не более 128 байт). Может быть идентификатором сотрудника ВАТС, внутренним номером группы операторов ВАТС или любым другим номером. К номеру будут применены правила преобразования номеров ВАТС"
    CommandsCallback_group:
      type: object
      properties:
        command_id:
          type: string
          example: "cbk1"
          description: "Идентификатор команды (строка не более 128 байт). Формируется внешней системой. ВАТС никак не обрабатывает этот идентификатор, не анализирует и не полагается на уникальность его значения. Идентификатор можно использовать для связи команды с результатом ее выполнения и возможными последующими событиями, которые появляются в результате выполнения команды"
        from:
          type: string
          example: "1234"
          description: "Данные, относящиеся к вызывающей стороне. Обязательный параметр. Может быть внешним номером либо коротким номером группы. Если в поле from указан внешний номер, а в поле to указан номер группы, то ВАТС сначала совершает дозвон на внешний номер, а после ответа клиента – начинает дозвон на группу (по заданному в группе алгоритму). Если в поле from указан номер группы, а в поле to указан внешний номер, то ВАТС сначала совершает дозвон на группу (по заданному в группе алгоритму), а после ответа оператора – начинает дозвон на внешний номер."  
        to:
          type: string
          example: "9991234567"
          description: "Данные, относящиеся к вызываемой стороне. Обязательный параметр. Может быть внешним номером либо коротким номером группы. Короткий номер группы обязателен для заполнения либо в поле from либо в поле to"
        line_number:
          type: string
          example: "4951234567"
          description: "Линия ВАТС, которая должна быть использована для размещения вызова. Обязательный параметр. Линия должна принадлежать тому же ВАТС, что и группа. Поддерживаются следующие типы линий: SIP UAC, номера 7-800, DID-номера. Важно! Чтобы вызов прошел через sip-линию, Вам  нужно указать имя  этой линии (а не SIP URI) в параметре line_number. Имя sip-линии задается в Личном кабинете MANGO OFFICE."
    CommandsCallback_groupResponses:      
      type: object
      properties:
        command_id:
          type: string
          example: "cbk1"
          description: "Идентификатор команды (строка не более 128 байт)"
        result:
          type: string
          example: "1000"
          description: "Результат выполнения команды инициирования вызова от внешней системы. Возможные значения результата: 1000 - команда выполнена успешно, 2xxx - команда запрещена биллинговой системой ВАТС, 3100 - переданы неверные параметры либо команда не может быть выполнена с этими параметрами, 4300 - SMS сообщение отправить не удалось, 5ххх - ошибка сервера"
          enum:
            - '1000' 
            - '2xxx'
            - '3100'
            - '4300'
            - '5xxx'
    Commandssms:
      type: object

      properties:
          command_id:
            type: string
            example: "cbk1"
            description: "Идентификатор команды (строка не более 128 байт). Формируется внешней системой. ВАТС никак не обрабатывает этот идентификатор, не анализирует и не полагается на уникальность его значения. Идентификатор можно использовать для связи команды с результатом ее выполнения и возможными последующими событиями, которые появляются в результате выполнения команды"
          text:
            type: string
            example: "Hello world!"
            description: "Текст сообщения. Ограничение поля — 612 символов для латиницы и 268 для кириллицы (4 сегмента по 153 и 67 символов соответственно)"
          from_extension:
            type: integer
            example: 18
            description: "Идентификатор сотрудника. Обязательное поле. Если у сотрудника ВАТС нет идентификатора (внутреннего номера), выполнение команды от его имени невозможно. За счет данного абонента будет выполняться тарификация. Примечания: 1) если указан короткий номер сотрудника, будет отправлено на номер по умолчанию для данного сотрудника (первый номер в списке в настройках карточки сотрудника); 2) если указан не короткий номер сотрудника, то может быть как sip-номером, так и ТфОП номером"
          to_number:
            type: string
            example: "79991234567"
            description: "Номер вызываемого абонента (строка не более 128 байт). Может быть любым номером, кроме коротких номеров сотрудников АТС. К номеру будут применены правила преобразования номеров ВАТС"
          sms_sender:
            type: string
            example: "Operator 007"
            description: "Имя отправителя SMS-сообщения. Поле опциональное (строка не более 128 байт), если заполнено - ВАТС будет использовать указанное в этом параметре имя отправителя. Если не заполнено или не допустимо - будет использоваться имя отправителя, выбранное в ЛК. Примечание. Возможны следующие варианты использования: 1) если у клиента в ЛК доступно к выбору только имя по умолчанию, допускается в данном поле передать только имя по умолчанию; 2) если у клиента в ЛК доступно к выбору имя по умолчанию либо отраслевое, допускается в данном поле передать имя по умолчанию либо любое доступное отраслевое имя; 3) если у клиента в ЛК доступно к выбору имя по умолчанию, либо отраслевое имя, либо подтвержденное уникальное имя, то допускается в данном поле передать имя по умолчанию либо любое доступное отраслевое имя либо уникальное имя."
    CommandssmsResponses:
      type: object
      properties:
        command_id:
          type: string
          example: "cbk1"
          description: "Идентификатор команды (строка не более 128 байт)"
        result:
          type: string
          example: "1000"
          description: "Результат выполнения команды инициирования вызова от внешней системы. Возможные значения результата: 1000 - команда выполнена успешно, 2xxx - команда запрещена биллинговой системой ВАТС, 3100 - переданы неверные параметры либо команда не может быть выполнена с этими параметрами, 4001 - команда не поддерживается, 5ххх - ошибка сервера"
          enum:
            - '1000' 
            - '2xxx'
            - '3100'
            - '4001'
            - '5xxx'
    CommandRecordingStart:
      type: object
      properties:
          command_id:
            type: string
            example: "cbk1"
            description: "Идентификатор команды (строка не более 128 байт). Формируется внешней системой. ВАТС никак не обрабатывает этот идентификатор, не анализирует и не полагается на уникальность его значения. Идентификатор можно использовать для связи команды с результатом ее выполнения и возможными последующими событиями, которые появляются в результате выполнения команды"
          call_id:
            type: string
            description: "Внутренний идентификатор вызова, строка. Не имеет отношения к CALL-ID из SIP протокола. В случае перевода вызова, call id может меняться, если записываемый абонент сменил собеседника (см. далее диаграмму переходов для состояния процесса записи разговора)"
          call_party_number:
            type: string
            example: "18"
            description: "Номер абонента (строка не более 128 байт), участвующего в вызове, которого нужно начать записывать. Может быть только идентификатором сотрудника ВАТС (предпочтительно) или одним из номеров сотрудника ВАТС, который указан в настройках ВАТС. К номеру будут применены правила преобразования номеров ВАТС. Если ВАТС не сможет идентифицировать сотрудника ВАТС по номеру, результат выполнения команды будет равен 3330 (Номер не найден у ВАТС или сотрудника)"
    CommandRecordingResponses:
      type: object
      properties:
        command_id:
          type: string
          example: "cbk1"
          description: "Идентификатор команды (строка не более 128 байт)"
        result:
          type: string
          example: "1000"
          description: "Результат выполнения команды инициирования вызова от внешней системы. Возможные значения результата: 1000 - команда выполнена успешно, 22xx - Запись разговора запрещена биллинговой системой, 333х - Не найден номер абонента, участвующего в вызове, которого нужно начать записывать, 4001 - команда не поддерживается, 41хх - Выполнить команду по логике работы ВАТС невозможно,  5ххх - ошибка сервера"
          enum:
            - '1000' 
            - '22xx'
            - '333х'
            - '4001'
            - '41хх'
            - '5xxx'      
    CommandPlayStart:
      type: object
      properties:
          command_id:
            type: string
            example: "cbk1"
            description: "Cтрока, обязательно, не более 128 байт. Идентификатор команды. Формируется внешней системой. ВАТС никак не обрабатывает этот идентификатор, не анализирует и не полагается на уникальность его значения. Идентификатор можно использовать для связи команды с результатом ее выполнения"
          call_id:
            type: string
            description: "Cтрока, обязательно, не более 128 байт . Идентификатор вызова"
          after_play_time:
            type: integer
            example: 5
            description: "Дополнительное время в секундах, которое будет ожидать ВАТС после окончания проигрывания и до продолжения обработки звонка. Может быть полезна как задержка для ввода DTMF"
          internal_id:
            type: integer
            example: 5
            description: "Число, опционально. ID аудиофайла в облачном хранище из продукта клиента. Может быть получен из результата Запрос на получение информации о «мелодиях/звуковых сообщениях». Важно. Поле internal_id обязательно для заполнения. Если этополе будет пустым - будет просто задержка в размере after_play_time"
    CommandPlayStartResponses:
      type: object
      properties:
        command_id:
          type: string
          example: "cbk1"
          description: "Идентификатор команды (строка не более 128 байт)"
        result:
          type: string
          example: "1000"
          description: "Результат выполнения команды инициирования вызова от внешней системы. Возможные значения результата: 1000 - команда выполнена успешно, 333х - Не найден номер абонента, участвующего в вызове, которого нужно начать записывать, 4001 - команда не поддерживается, 41хх - Выполнить команду по логике работы ВАТС невозможно,  5ххх - ошибка сервера"
          enum:
            - '1000' 
            - '333х'
            - '4001'
            - '41хх'
            - '5xxx'       
 
    forwarding_numbersResponses:
      required:
        - data
        - result
      type: object
      properties:
        result:
          type: string
          example: "1000"
          description: "Результат выполнения команды инициирования вызова от внешней системы. Возможные значения результата: 1000 - команда выполнена успешно, 3300 - объект не существует, 5ххх - исключение"
          enum:
            - '1000' 
            - '3300'
            - '5xxx'
        data:
          $ref: '#/components/schemas/forwarding_numbersResponses_data'
    forwarding_numbersResponses_data:
      type: object
      properties:
        numbers:
          $ref: '#/components/schemas/forwarding_numbersResponses_data_numbers'
    forwarding_numbersResponses_data_numbers:  
      type: object
      format: array
      properties:
        forward_id:
          type: integer
          example: '10023131'
          description: "ID правила переадресации"
        client_phone_number:
          type: string
          example: "79993692503"
          description: "Номер, с которого поступает входящий звонок"
        client_phone_type:
          type: boolean
          example: "0"
          description: "Тип номера, с которого поступает входящий звонок: 0 - телефон, 1 - SIP-Номер"
        
        status:
          type: boolean
          example: 0
          description: "Статус активности правила переадресации: 0 - правило неактивно,1 - правило активно"
        comment:
          type: string
          example: "Комментарий"
          description: "Комментарий"
        forward_type:
          type: string
          example: "ext_forward"
          description: "Тип переадресации. Возможные значения: group - группа, user - сотрудник, ext_forward - внешний номер"
          enum:
            - group
            - approved
            - ext_forward
        forward_to_group:
           $ref: '#/components/schemas/forwarding_numbersResponses_data_numbers_forward_to_group'
        forward_to_user:
          $ref: '#/components/schemas/forwarding_numbersResponses_data_numbers_forward_to_user'
        forward_to_ext:
          $ref: '#/components/schemas/forwarding_numbersResponses_data_numbers_forward_to_ext'
    forwarding_numbersResponses_data_numbers_forward_to_group:  
      type: object
      format: array
      description: "Массив данных при переадресации на группу; возвращается, если у параметра forward_type указано значение group, массив"
      properties:
        forward_group_id:
          type: integer
          description: "ID сотрудника, на которого осуществляется переадресация"
    forwarding_numbersResponses_data_numbers_forward_to_user:
      type: object
      format: array
      description: "Массив данных при переадресации на сотрудника; возвращается, если у параметра forward_type указано значение user, массив"
      properties:
        forward_user_id:
          type: integer
          description: "ID сотрудника, на которого осуществляется переадресация"
        forward_contact_id:
          type: integer
          description: "ID контакта сотрудника, на который осуществляется переадресация"
        is_default_contact_id:
          type: boolean
          description: "Тип номера сотрудника. Возможные значения6 0- стандатный номер сотрудника, 1 - номер по-умолчанию"
    forwarding_numbersResponses_data_numbers_forward_to_ext:
      type: object
      format: array
      description: "Массив данных при переадресации на внешний номер; возвращается, если у параметра forward_type указано значение ext_forward, массив"
      properties:
        forward_number_type:
          type: boolean
          example: 0
          description: "Тип внешнего номера, на который осуществляется переадресация вызова: 0 - телефон, 1 - SIP-Номер"
        forward_number:
          type: string
          example: "741258"
          description: "Тип «string», внешний номер, на который осуществляется переадресация вызова"
        forward_wait_sec:
          type: integer
          example: 15
          description: "Время ожидания ответа абонента (в секундах) при переадресации на внешний номер"

  parameters:
    vpbx_api_key:
      type: string
      example: "1234567890qwerty"
      description: "Уникальный код вашей ВАТС. Это обязательный элемент запроса, по которогому ВАТС определяет внешнюю систему, от корой отправлен запрос"
    sign:
      type: string
      example: "1234567890qwerty"
      description: "sign рассчитывается по формуле"
